<header class="fade-in-heading">
  <h1 class="text-2xl font-bold text-white">Dashboard</h1>
  <p class="mt-2 text-neutral-400">View your API usage statistics.</p>
</header>

<div class="fade-in animation-delay-2 mt-6 mb-6 max-w-2xl">
  <%~ include('../_components/flash-message.html') %>
</div>

<!-- Usage Section -->
<div class="fade-in animation-delay-3 mb-8 rounded-lg border border-neutral-800 bg-neutral-900 p-6 max-w-2xl flex flex-col gap-4">
  <div class="flex items-center justify-between">
    <h2 class="text-lg font-semibold text-white">API Usage</h2>
    <% if (it.user.admin) { %>
    <span class="text-2xl font-bold text-power">Unlimited</span>
    <% } else { %>
    <span class="text-2xl font-bold text-white"><%= it.usagePercent %>%</span>
    <% } %>
  </div>
  <div>
    <div class="mb-2 h-3 w-full overflow-hidden rounded-full bg-neutral-800">
      <div
        class="h-full rounded-full bg-power transition-all"
        style="width: <%= it.user.admin ? 100 : Math.min(it.usagePercent, 100) %>%"
      ></div>
    </div>
    <p class="text-sm text-neutral-400">
      <span class="font-medium text-white"><%= it.user.api_call_count.toLocaleString() %></span>
      <% if (it.user.admin) { %>
      calls made
      <% } else { %>
      of <span class="font-medium text-white"><%= it.user.api_call_limit.toLocaleString() %></span> calls used this month
      <% } %>
    </p>
  </div>
</div>

<% if (it.user.admin && it.stats) { %>
<!-- Admin: System Overview -->
<div class="fade-in animation-delay-4 max-w-2xl">
  <h2 class="mb-4 text-lg font-semibold text-white">System Overview</h2>
  <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
    <%~ include('../_components/stat-card.html', { value: it.stats.totalUsers, label: 'Total Users', color: 'text-white' }) %>
    <%~ include('../_components/stat-card.html', { value: it.stats.verifiedUsers, label: 'Verified Users', color: 'text-white' }) %>
    <%~ include('../_components/stat-card.html', { value: it.stats.unverifiedUsers, label: 'Unverified Users', color: 'text-white' }) %>
    <%~ include('../_components/stat-card.html', { value: it.stats.adminUsers, label: 'Admin Users', color: 'text-white' }) %>
    <%~ include('../_components/stat-card.html', { value: it.stats.cacheEntries, label: 'Cache Entries', color: 'text-white' }) %>
    <%~ include('../_components/stat-card.html', { value: it.stats.totalApiCalls.toLocaleString(), label: 'Total API Calls', color: 'text-white' }) %>
  </div>
</div>
<% } %>
